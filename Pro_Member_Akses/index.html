<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>UMT Pro Command Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500;600&family=Inter:wght@400;600;700&display=swap');
        :root {
            --bg-main: #0D1117; --bg-panel: #161B22; --border-color: #30363D;
            --text-primary: #C9D1D9; --text-secondary: #8B949E; --accent-cyan: #2F81F7;
            --accent-green: #39D353; --accent-red: #F85149;
        }
        body { background-color: var(--bg-main); color: var(--text-primary); font-family: 'Inter', sans-serif; }
        .font-mono { font-family: 'Fira Code', monospace; }
        .panel { background-color: var(--bg-panel); border: 1px solid var(--border-color); border-radius: 0.75rem; padding: 1.5rem; }
        .bottom-nav-link.active { color: var(--accent-cyan); }
        .sidebar-link.active { background-color: #30363D; color: white; }
        .card-item { background-color: #21262D; transition: transform 0.2s; cursor: pointer; }
        .card-item:hover { transform: translateY(-4px); background-color: #30363D; }
        .quiz-option { border: 2px solid var(--border-color); }
        .quiz-option:hover { border-color: var(--accent-cyan); }
        .quiz-option.selected { border-color: var(--accent-cyan); background-color: rgba(47, 129, 247, 0.2); }
        .correct-answer { background-color: rgba(57, 211, 83, 0.1); border-left: 4px solid var(--accent-green); }
        .wrong-answer { background-color: rgba(248, 81, 73, 0.1); border-left: 4px solid var(--accent-red); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .nav-btn:disabled { background-color: #30363D; color: #8B949E; cursor: not-allowed; }

        @keyframes slideInRight { from { opacity: 0; transform: translateX(100%); } to { opacity: 1; transform: translateX(0); } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; transform: translateY(-20px); } }
        .toast-in { animation: slideInRight 0.5s forwards; }
        .toast-out { animation: fadeOut 0.5s forwards; }
/* ================================================= */
/* ==  STYLE UNTUK HALAMAN FORUM UMT              == */
/* ================================================= */

.forum-container {
    background-color: var(--bg-panel);
    border: 1px solid var(--border-color);
    border-radius: 0.75rem; /* Sesuai dengan style .panel */
    padding: 2.5rem 2rem;
    max-width: 800px;
    margin: 2rem auto;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

/* Bagian Judul dan Deskripsi Awal */
.intro h1 {
    font-size: 2.25rem; /* 36px */
    font-weight: 700;
    color: var(--accent-cyan);
    margin-bottom: 0.75rem;
}

.intro p {
    color: var(--text-secondary);
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
    line-height: 1.6;
}

/* Bagian Link Komunitas */
.community-links {
    margin-top: 3rem;
    padding-top: 2rem;
    border-top: 1px solid var(--border-color);
}

.community-links h2 {
    font-size: 1.25rem; /* 20px */
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 1.5rem;
}

/* Tombol untuk Join Komunitas */
.community-btn {
    text-decoration: none;
    color: white;
    font-weight: bold;
    padding: 0.75rem 1.5rem; /* py-3 px-6 */
    border-radius: 9999px; /* rounded-full */
    display: inline-flex;
    align-items: center;
    gap: 0.75rem; /* gap-3 */
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.community-btn i {
    font-size: 1.25rem;
}

.community-btn:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
}

.whatsapp-btn {
    background-color: #25D366; /* Warna resmi WhatsApp */
}
.whatsapp-btn:hover {
    background-color: #1DAA54;
}

.telegram-btn {
    background-color: #229ED9; /* Warna resmi Telegram */
}
.telegram-btn:hover {
    background-color: #1C84B3;
}

/* Teks kecil di bawah tombol */
.community-links .subtext {
    color: var(--text-secondary);
    margin-top: 1.5rem;
    font-size: 0.875rem;
}

/* Penyesuaian untuk layar mobile */
@media (max-width: 768px) {
    .intro h1 {
        font-size: 1.75rem; /* Perkecil judul di mobile */
    }
    .forum-container {
        padding: 2rem 1rem;
        margin: 1rem;
    }
    .community-btn {
        width: 100%; /* Buat tombol memenuhi lebar di mobile */
        justify-content: center;
    }
}

/* Bagian Bank Soal  */
 @media (max-width: 640px) {
     #single-explanation-container > div {
         padding: 1rem;
         margin-bottom: 1rem;
         overflow-x: auto; /* Tambahkan scroll horizontal jika konten terlalu lebar */
     }

     #single-explanation-container .text-lg {
         font-size: 1rem;
     }

     #single-explanation-container .text-sm {
         font-size: 0.875rem;
     }

     #single-explanation-container .font-bold {
         font-size: 1rem;
     }

     .flex.justify-between.items-center.mt-8 {
         flex-direction: column;
         gap: 0.75rem;
     }

     .flex.justify-between.items-center.mt-8 > button {
         width: 100%;
     }
 }
    </style>
</head>
<body class="text-white">

    <div class="flex min-h-screen">
        <aside class="fixed bottom-0 left-0 z-50 w-full h-16 bg-[var(--bg-panel)] border-t border-[var(--border-color)] 
                       md:relative md:w-64 md:h-screen md:flex md:flex-col md:border-t-0 md:border-r md:p-6">
            <h1 class="hidden text-xl font-bold mb-10 text-cyan-400 md:block md:text-2xl">UMT Pro</h1>
            <nav id="sidebar-nav" class="no-scrollbar flex overflow-x-auto h-full md:flex-col md:space-y-4 md:h-auto">
                <div class="flex flex-nowrap items-center justify-start gap-2 px-2 md:flex-col md:items-stretch md:gap-0 md:px-0">
                    <a href="#" class="sidebar-link bottom-nav-link flex-shrink-0 w-20 flex flex-col items-center justify-center p-2 text-center text-gray-400 rounded-lg hover:text-white md:w-full md:flex-row md:justify-start md:gap-4 md:hover:bg-gray-700" onclick="event.preventDefault(); navigateTo('dashboard', this)">
                        <i class="fa-solid fa-chart-pie text-lg md:w-6"></i><span class="text-xs mt-1 md:text-base md:mt-0">Dashboard</span>
                    </a>
                    <a href="#" class="sidebar-link bottom-nav-link flex-shrink-0 w-20 flex flex-col items-center justify-center p-2 text-center text-gray-400 rounded-lg hover:text-white md:w-full md:flex-row md:justify-start md:gap-4 md:hover:bg-gray-700" onclick="event.preventDefault(); navigateTo('materi', this)">
                        <i class="fa-solid fa-book text-lg md:w-6"></i><span class="text-xs mt-1 md:text-base md:mt-0">Materi</span>
                    </a>
                    <a href="#" class="sidebar-link bottom-nav-link flex-shrink-0 w-20 flex flex-col items-center justify-center p-2 text-center text-gray-400 rounded-lg hover:text-white md:w-full md:flex-row md:justify-start md:gap-4 md:hover:bg-gray-700" onclick="event.preventDefault(); navigateTo('bank_soal', this)">
                        <i class="fa-solid fa-list-check text-lg md:w-6"></i><span class="text-xs mt-1 md:text-base md:mt-0">Bank Soal</span>
                    </a>
                    <a href="#" class="sidebar-link bottom-nav-link flex-shrink-0 w-20 flex flex-col items-center justify-center p-2 text-center text-gray-400 rounded-lg hover:text-white md:w-full md:flex-row md:justify-start md:gap-4 md:hover:bg-gray-700" onclick="event.preventDefault(); navigateTo('video', this)">
                        <i class="fa-solid fa-video text-lg md:w-6"></i><span class="text-xs mt-1 md:text-base md:mt-0">Video</span>
                    </a>
                    <a href="#" class="sidebar-link bottom-nav-link flex-shrink-0 w-20 flex flex-col items-center justify-center p-2 text-center text-gray-400 rounded-lg hover:text-white md:w-full md:flex-row md:justify-start md:gap-4 md:hover:bg-gray-700" onclick="event.preventDefault(); navigateTo('forum', this)">
                        <i class="fa-solid fa-comments text-lg md:w-6"></i><span class="text-xs mt-1 md:text-base md:mt-0">Forum</span>
                    </a>
                    <a href="#" class="sidebar-link bottom-nav-link flex-shrink-0 w-20 flex flex-col items-center justify-center p-2 text-center text-gray-400 rounded-lg hover:text-white md:w-full md:flex-row md:justify-start md:gap-4 md:hover:bg-gray-700" onclick="event.preventDefault(); navigateTo('pengaturan', this)">
                        <i class="fa-solid fa-user-gear text-lg md:w-6"></i><span class="text-xs mt-1 md:text-base md:mt-0">Pengaturan</span>
                    </a>
                </div>
            </nav>
            <div class="hidden mt-auto md:block">
                <button onclick="logout()" class="w-full bg-red-800 hover:bg-red-700 text-white py-2 px-3 rounded">
                    <i class="fa-solid fa-right-from-bracket"></i><span class="md:inline"> Logout</span>
                </button>
            </div>
        </aside>

        <main id="app-content" class="flex-1 p-6 space-y-6 pb-20 md:pb-6"></main>
    </div>

    <div id="toast-container" class="fixed top-5 right-5 z-[100] space-y-3 w-80"></div>

<script>
// =================================================================================
// BAGIAN 0: KONFIGURASI DAN DATA MASTER (GLOBAL)
// =================================================================================
const allContentData = {
    materi: [
        { id: 'materi_1', title: 'Materi Aljabar', type: 'Materi' },
        { id: 'materi_2', title: 'Materi Kalkulus', type: 'Materi' }
    ],
    video: [
        { id: 'video_1', title: 'Video Pembahasan Vektor', type: 'Video' }
    ],
    bankSoal: [
        {
            id: 'tiu_1', title: 'Paket Latihan TIU #1', subject: 'Tes Intelegensi Umum - Analogi', totalQuestions: 5,
            questions: [
                { questionText: 'MATA : WAJAH', options: ['A. Bantal : Ranjang', 'B. Buku : Perpustakaan', 'C. Jendela : Rumah', 'D. Air : Ember'], correctAnswer: 'C. Jendela : Rumah', explanation: 'Analogi ini adalah hubungan "bagian dari". MATA adalah bagian dari WAJAH, sebagaimana JENDELA adalah bagian dari RUMAH.' },
                { questionText: 'API : BAKAR', options: ['A. Air : Minum', 'B. Es : Beku', 'C. Angin : Sejuk', 'D. Tanah : Subur'], correctAnswer: 'B. Es : Beku', explanation: 'Analogi ini menunjukkan sifat atau fungsi. Sifat API adalah MEMBAKAR, sebagaimana sifat ES adalah MEMBEKUKAN (atau menjadi BEKU).' },
                { questionText: 'GELAP : TERANG', options: ['A. Siang : Malam', 'B. Basah : Kering', 'C. Panas : Hangat', 'D. Manis : Gula'], correctAnswer: 'B. Basah : Kering', explanation: 'Analogi ini adalah hubungan antonim atau lawan kata. GELAP adalah lawan kata dari TERANG, sebagaimana BASAH adalah lawan kata dari KERING.'},
                { questionText: 'PADI : PETANI', options: ['A. Obat : Dokter', 'B. Buku : Penulis', 'C. Emas : Penambang', 'D. Murid : Guru'], correctAnswer: 'C. Emas : Penambang', explanation: 'Hubungan analogi ini adalah "hasil dari pekerjaan". PADI adalah hasil kerja PETANI, sebagaimana EMAS adalah hasil kerja PENAMBANG.'},
                { questionText: 'JARUM : BENANG', options: ['A. Kuas : Cat', 'B. Palu : Paku', 'C. Pulpen : Tinta', 'D. Gunting : Kertas'], correctAnswer: 'A. Kuas : Cat', explanation: 'Hubungan ini adalah "alat dan bahan yang digunakan bersamaan". JARUM digunakan bersama BENANG, sebagaimana KUAS digunakan bersama CAT.'}
            ]
        },
        {
            id: 'twk_1', title: 'Paket Latihan TWK #1', subject: 'Tes Wawasan Kebangsaan', totalQuestions: 3,
            questions: [
                { questionText: 'Pancasila disahkan pada tanggal...', options: ['A. 17 Agustus 1945', 'B. 18 Agustus 1945', 'C. 1 Juni 1945', 'D. 28 Oktober 1928'], correctAnswer: 'B. 18 Agustus 1945', explanation: 'Pancasila disahkan sebagai dasar negara oleh PPKI pada tanggal 18 Agustus 1945, satu hari setelah proklamasi kemerdekaan.'},
                { questionText: 'Siapakah yang mengetik naskah proklamasi?', options: ['A. Soekarno', 'B. Moh. Hatta', 'C. Sayuti Melik', 'D. Ahmad Soebardjo'], correctAnswer: 'C. Sayuti Melik', explanation: 'Naskah proklamasi kemerdekaan Indonesia diketik oleh Sayuti Melik setelah disetujui dan ditandatangani oleh Soekarno dan Moh. Hatta.'},
                { questionText: 'Lagu Indonesia Raya diciptakan oleh...', options: ['A. Ismail Marzuki', 'B. W.R. Supratman', 'C. C. Simanjuntak', 'D. Ibu Sud'], correctAnswer: 'B. W.R. Supratman', explanation: 'Lagu kebangsaan Indonesia Raya diciptakan oleh Wage Rudolf Supratman.'}
            ]
        }
    ]
};

const socialMediaUpdates = [
    { platform: 'YouTube', icon: 'fa-brands fa-youtube', color: 'text-red-500', text: 'Video baru: Pembahasan TPA Kuantitatif', link: 'https://youtube.com' },
    { platform: 'TikTok', icon: 'fa-brands fa-tiktok', color: 'text-white', text: 'Tips & Trik: 3 Detik Jawab Soal Silogisme', link: 'https://tiktok.com' },
    { platform: 'Instagram', icon: 'fa-brands fa-instagram', color: 'text-pink-500', text: 'Jadwal Try Out Nasional Gratis di Story!', link: 'https://instagram.com' }
];


// =================================================================================
// BAGIAN 1: LOGIKA SESI & KEAMANAN
// =================================================================================
// ... (Kode Bagian 1 tidak berubah, jadi saya singkat)
const WEB_APP_URL = '#'; const LOGIN_PAGE_URL = '#'; let heartbeatIntervalId = null;
function startSessionHeartbeat(token, email) { /* ... */ } async function verifySession(token, email) { /* ... */ }
function logout() { sessionStorage.clear(); if (heartbeatIntervalId) clearInterval(heartbeatIntervalId); showToast("Anda telah berhasil logout.", "success"); setTimeout(() => { window.location.href = LOGIN_PAGE_URL; }, 1500); }
function forceLogout(message) { if (heartbeatIntervalId) clearInterval(heartbeatIntervalId); showToast(message, 'error'); setTimeout(() => { window.location.href = LOGIN_PAGE_URL; }, 2000); }
(function gatekeeper() { const token = sessionStorage.getItem('sessionToken'); const email = sessionStorage.getItem('sessionEmail'); if (!token || !email) { /* window.location.href = LOGIN_PAGE_URL; return; */ } /* startSessionHeartbeat(token, email); */ document.addEventListener('DOMContentLoaded', () => initializeApp()); })();


// =================================================================================
// BAGIAN 2: LOGIKA APLIKASI UTAMA (NAVIGASI & RENDER GLOBAL)
// =================================================================================
const appContent = document.getElementById('app-content');

function navigateTo(page, clickedElement) {
    document.querySelectorAll('.sidebar-link, .bottom-nav-link').forEach(link => link.classList.remove('active'));
    if (clickedElement) clickedElement.classList.add('active');

    if (page === 'dashboard') {
        renderDashboardPage();
    } else {
        fetchAndRenderPage(page);
    }
}

async function fetchAndRenderPage(pageName) {
    // Fungsi ini sekarang hanya akan memuat file HTML statis
    // Logika dinamis akan ditangani oleh fungsi render masing-masing
    appContent.innerHTML = `<p class="text-center text-gray-400">Memuat...</p>`;
    try {
        const response = await fetch(`halaman/${pageName}.html`);
        if (!response.ok) throw new Error(`Halaman tidak ditemukan`);
        const html = await response.text();
        appContent.innerHTML = html;
        // Panggil fungsi spesifik setelah memuat HTML
        if(pageName === 'bank_soal') renderBankSoalPage();
        if(pageName === 'materi') renderMateriPage();
        if(pageName === 'video') renderVideoPage();
        if(pageName === 'pengaturan') renderPengaturanPage();
        if(pageName === 'forum') renderForumPage();
    } catch (error) {
        console.error(`Error memuat halaman '${pageName}':`, error);
        appContent.innerHTML = `<p class="text-center text-red-500">Gagal memuat konten.</p>`;
    }
}

// =================================================================================
// BAGIAN 3: FUNGSI RENDER UNTUK SETIAP HALAMAN
// =================================================================================
function renderDashboardPage() {
    appContent.innerHTML = `
        <header class="panel flex justify-between items-center">
            <div>
                <h2 id="user-greeting" class="text-xl font-bold"></h2>
                <p class="text-sm text-gray-400">Selamat datang di Command Center Anda.</p>
            </div>
        </header>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="col-span-1 lg:col-span-2 space-y-6">
                <div class="panel">
                    <h4 class="font-bold text-lg mb-4">Status Anda</h4>
                    <div id="status-container" class="space-y-4"></div>
                </div>
                <div id="last-score-widget-container"></div>
            </div>
            <div class="col-span-1 space-y-6">
                <div class="panel">
                    <h4 class="font-bold text-lg mb-4">Pencapaian</h4>
                    <div id="lencana-container" class="flex gap-4"></div>
                </div>
                 <div class="panel">
                    <h4 class="font-bold text-lg mb-4">Info Terbaru UMT</h4>
                    <div id="social-media-container" class="space-y-4"></div>
                </div>
            </div>
        </div>
    `;
    initializeAppDashboardWidgets();
}

function renderMateriPage() {
    // Logika untuk menampilkan daftar materi dari allContentData.materi
    const materiHTML = `
        <div class="panel">
            <h2 class="text-2xl font-bold text-cyan-400">Materi Belajar</h2>
            <p class="text-sm text-gray-400 mb-6">Pilih materi untuk mulai belajar.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                ${allContentData.materi.map(item => `
                    <div class="card-item p-6 rounded-lg flex flex-col" onclick="markAsCompleted('${item.id}')">
                         <h3 class="font-bold text-lg mb-2">${item.title}</h3>
                         <p class="text-sm text-gray-400 mb-4">${item.type}</p>
                    </div>
                `).join('')}
            </div>
        </div>`;
    appContent.innerHTML = materiHTML;
}

function renderVideoPage() {
    // Logika untuk menampilkan daftar video dari allContentData.video
    const videoHTML = `
        <div class="panel">
            <h2 class="text-2xl font-bold text-cyan-400">Video Pembelajaran</h2>
            <p class="text-sm text-gray-400 mb-6">Tonton video pilihan untuk pemahaman lebih dalam.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                ${allContentData.video.map(item => `
                    <div class="card-item p-6 rounded-lg flex flex-col" onclick="markAsCompleted('${item.id}')">
                         <h3 class="font-bold text-lg mb-2">${item.title}</h3>
                         <p class="text-sm text-gray-400 mb-4">${item.type}</p>
                    </div>
                `).join('')}
            </div>
        </div>`;
    appContent.innerHTML = videoHTML;
}

function renderBankSoalPage() {
    const bankSoalHTML = `
        <div class="panel">
            <h2 class="text-2xl font-bold mb-1 text-cyan-400">Bank Soal</h2>
            <p class="text-sm text-gray-400 mb-6">Pilih paket soal untuk mulai berlatih.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                ${allContentData.bankSoal.map(quiz => `
                    <div class="card-item p-6 rounded-lg flex flex-col" onclick="startQuiz('${quiz.id}')">
                        <h3 class="font-bold text-lg mb-2">${quiz.title}</h3>
                        <p class="text-sm text-gray-400 mb-4">${quiz.subject}</p>
                        <div class="mt-auto text-xs font-mono bg-gray-900/50 text-cyan-300 rounded-full px-3 py-1 self-start">
                            ${quiz.totalQuestions} Soal
                        </div>
                    </div>
                `).join('')}
            </div>
        </div>
    `;
    appContent.innerHTML = bankSoalHTML;
}

function renderForumPage() {
    const forumHTML = `<div class="forum-container"><div class="intro"><h1>Forum Belajar UMT</h1><p>Bergabunglah dengan komunitas eksklusif UMT Academy! Tempat terbaik untuk berdiskusi, bertanya, berbagi ilmu, dan menguasai matematika bersama sesama pelajar dan fasilitator.</p></div><div class="community-links"><h2>Pilih Komunitas Pilihanmu Sekarang!</h2><div class="flex justify-center gap-4 flex-wrap"><a href="https://chat.whatsapp.com/GpyKRFFjMINBcjqGEYSXQ6" target="_blank" class="community-btn whatsapp-btn"><i class="fab fa-whatsapp"></i><span>Komunitas WhatsApp</span></a><a href="https://t.me/umt6174" target="_blank" class="community-btn telegram-btn"><i class="fab fa-telegram"></i><span>Komunitas Telegram</span></a></div><p class="subtext">Bergabunglah dengan ribuan pelajar lainnya!</p></div></div>`;
    appContent.innerHTML = forumHTML;
}

function renderPengaturanPage() {
    const pengaturanHTML = `<div class="panel max-w-2xl mx-auto"><h2 class="text-2xl font-bold mb-1 text-cyan-400">Pengaturan</h2><p class="text-sm text-gray-400 mb-6">Kelola data aplikasi Anda di sini.</p><div class="bg-gray-900/50 p-4 rounded-lg"><div class="flex items-center justify-between"><div><h4 class="font-bold">Reset Progres Belajar</h4><p class="text-xs text-gray-400 mt-1">Aksi ini akan menghapus semua progres dan lencana Anda. Tidak dapat diurungkan.</p></div><button onclick="resetProgress()" class="bg-red-800 hover:bg-red-700 text-white text-sm font-bold py-2 px-4 rounded-lg flex-shrink-0">Reset Data</button></div></div></div>`;
    appContent.innerHTML = pengaturanHTML;
}

// =================================================================================
// BAGIAN 4: LOGIKA WIDGET DASBOR & PROGRES
// =================================================================================
function initializeAppDashboardWidgets() {
    const email = sessionStorage.getItem('sessionEmail') || 'pengguna@email.com';
    const namePart = email.split('@')[0];
    document.getElementById('user-greeting').innerHTML = `Halo, ${namePart.charAt(0).toUpperCase() + namePart.slice(1)} 👋`;
    
    // Progres Keseluruhan
    const COMPLETED_KEY = 'userCompletedItems';
    const completedItems = JSON.parse(localStorage.getItem(COMPLETED_KEY)) || [];
    const totalItems = allContentData.materi.length + allContentData.video.length + allContentData.bankSoal.length;
    const progress = totalItems > 0 ? Math.round((completedItems.length / totalItems) * 100) : 0;
    
    document.getElementById('status-container').innerHTML = `<div><span class="text-sm">📚 Progress Keseluruhan (${completedItems.length}/${totalItems})</span><div class="w-full bg-gray-700 rounded-full h-2.5 mt-1"><div class="bg-cyan-500 h-2.5 rounded-full transition-all duration-500" style="width: ${progress}%"></div></div></div>`;
    
    // Lencana
    let lencanaHTML = '';
    if (completedItems.length >= 1) lencanaHTML += `<div title="Langkah Pertama"><i class="fa-solid fa-shoe-prints text-cyan-400 text-2xl"></i></div>`;
    if (progress >= 50) lencanaHTML += `<div title="Setengah Jalan!"><i class="fa-solid fa-road-circle-check text-green-400 text-2xl"></i></div>`;
    if (progress === 100) lencanaHTML += `<div title="100% Selesai!"><i class="fa-solid fa-trophy text-amber-400 text-2xl"></i></div>`;
    document.getElementById('lencana-container').innerHTML = lencanaHTML || `<p class="text-sm text-gray-500">Selesaikan materi untuk dapat lencana!</p>`;

    // Info Terbaru (Sosial Media)
    const socialContainer = document.getElementById('social-media-container');
    socialContainer.innerHTML = socialMediaUpdates.map(item => `
        <a href="${item.link}" target="_blank" class="flex items-start gap-3 p-2 rounded-lg hover:bg-gray-800">
            <i class="${item.icon} ${item.color} text-xl w-6 text-center"></i>
            <span class="text-sm text-gray-300">${item.text}</span>
        </a>
    `).join('');

    // Skor Terakhir
    const lastScoreContainer = document.getElementById('last-score-widget-container');
    const lastScoreData = JSON.parse(localStorage.getItem('lastQuizScore'));
    if (lastScoreData) {
        lastScoreContainer.innerHTML = `
            <div class="panel">
                <h4 class="font-bold text-lg mb-4">Skor Kuis Terakhir</h4>
                <div class="text-center">
                    <p class="text-sm text-gray-400">${lastScoreData.title}</p>
                    <p class="text-4xl font-bold text-cyan-400 mt-2">${lastScoreData.percentage}%</p>
                    <p class="text-gray-300 mt-1 text-xs">(${lastScoreData.score} dari ${lastScoreData.total} soal benar)</p>
                </div>
            </div>`;
    }
}

function resetProgress() {
    const confirmation = confirm("Apakah Anda yakin ingin mereset semua progres belajar Anda? Aksi ini tidak dapat dibatalkan.");
    if (confirmation) {
        localStorage.removeItem('userCompletedItems');
        localStorage.removeItem('lastQuizScore'); // Hapus juga skor terakhir
        showToast("Progres belajar berhasil direset.", "success");
        navigateTo('dashboard', document.querySelector('.sidebar-link'));
    } else {
        showToast("Aksi reset dibatalkan.", "info");
    }
}

// Fungsi untuk menandai materi/video selesai
function markAsCompleted(itemId) {
    const COMPLETED_KEY = 'userCompletedItems';
    let completed = JSON.parse(localStorage.getItem(COMPLETED_KEY)) || [];
    if (!completed.includes(itemId)) {
        completed.push(itemId);
        localStorage.setItem(COMPLETED_KEY, JSON.stringify(completed));
        showToast("Progres telah dicatat!", "success");
        navigateTo('dashboard', document.querySelector('.sidebar-link')); // Kembali ke dasbor
    } else {
        showToast("Item ini sudah selesai.", "info");
    }
}

// =================================================================================
// BAGIAN 5: LOGIKA KUIS (FUNGSI TETAP SAMA, TAPI DIPANGGIL DARI ATAS)
// =================================================================================
let currentQuizData = null;
let currentQuestionIndex = 0;
let userAnswers = [];
let currentExplanationIndex = 0;

function startQuiz(quizId) {
    currentQuizData = allContentData.bankSoal.find(q => q.id === quizId);
    if (!currentQuizData) { showToast('Kuis tidak ditemukan!', 'error'); return; }
    currentQuestionIndex = 0;
    userAnswers = new Array(currentQuizData.questions.length).fill(null);
    renderQuizInterface();
}

function renderQuizInterface() {
    const quiz = currentQuizData;
    const question = quiz.questions[currentQuestionIndex];
    const quizHTML = `<div class="panel max-w-4xl mx-auto"><div class="flex justify-between items-start mb-4"><div><h2 class="text-xl font-bold text-cyan-400">${quiz.title}</h2><p class="text-sm text-gray-400">Pertanyaan ${currentQuestionIndex + 1} dari ${quiz.questions.length}</p></div><button onclick="navigateTo('bank_soal', null)" class="text-xs text-gray-400 hover:text-white">&times; Tutup</button></div><hr class="border-gray-700 my-4"/><div class="mb-6 min-h-[60px]"><div class="text-lg text-gray-200">${question.questionText}</div></div><div id="quiz-options" class="space-y-3">${question.options.map((opt, index) => `<div id="option-${index}" class="quiz-option p-4 rounded-lg cursor-pointer transition-colors" onclick="selectAnswer('${opt.replace(/'/g, "\\'")}', ${index})">${opt}</div>`).join('')}</div><hr class="border-gray-700 my-6"/><div class="flex justify-end"><button id="next-btn" onclick="submitQuiz()" class="bg-cyan-600 hover:bg-cyan-500 text-white font-bold py-2 px-6 rounded-lg">${currentQuestionIndex === quiz.questions.length - 1 ? 'Selesai & Lihat Hasil' : 'Lanjut'}</button></div></div>`;
    appContent.innerHTML = quizHTML;
}

function selectAnswer(answer, optionIndex) {
    userAnswers[currentQuestionIndex] = answer;
    document.querySelectorAll('.quiz-option').forEach(el => el.classList.remove('selected'));
    document.getElementById(`option-${optionIndex}`).classList.add('selected');
}

function submitQuiz() {
    if (userAnswers[currentQuestionIndex] === null) { showToast('Silakan pilih jawaban terlebih dahulu!', 'error'); return; }
    if (currentQuestionIndex < currentQuizData.questions.length - 1) { currentQuestionIndex++; renderQuizInterface(); } else { renderQuizResults(); }
}

function renderQuizResults() {
    const quiz = currentQuizData;
    let score = 0;
    quiz.questions.forEach((q, index) => { if (q.correctAnswer === userAnswers[index]) { score++; } });
    
    // Tandai kuis ini sebagai selesai untuk progres keseluruhan
    markAsCompleted(quiz.id);

    // Simpan skor terakhir ke localStorage
    const finalScorePercentage = quiz.questions.length > 0 ? Math.round((score / quiz.questions.length) * 100) : 0;
    const lastScore = {
        title: quiz.title,
        score: score,
        total: quiz.questions.length,
        percentage: finalScorePercentage
    };
    localStorage.setItem('lastQuizScore', JSON.stringify(lastScore));
    
    const resultShellHTML = `<div class="panel max-w-4xl mx-auto"><h2 class="text-2xl font-bold text-center">Hasil Kuis: ${quiz.title}</h2><div class="text-center my-6 bg-gray-900/50 p-4 rounded-lg"><p class="text-gray-400">Skor Akhir Anda</p><p class="text-5xl font-bold text-cyan-400 mt-2">${finalScorePercentage}%</p><p class="text-gray-300 mt-2">(${score} dari ${quiz.questions.length} soal benar)</p></div><h3 id="explanation-title" class="font-bold text-xl mt-10 mb-4 text-center">⭐ Pembahasan Soal</h3><div id="single-explanation-container" class="min-h-[250px]"></div><div class="flex justify-between items-center mt-8 flex-wrap gap-4"><button id="prev-explanation-btn" onclick="prevExplanation()" class="nav-btn bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg"><i class="fa-solid fa-chevron-left"></i> Sebelumnya</button><button onclick="navigateTo('bank_soal', null)" class="bg-cyan-800 hover:bg-cyan-700 text-white text-sm py-2 px-4 rounded-lg">Kembali ke Bank Soal</button><button id="next-explanation-btn" onclick="nextExplanation()" class="nav-btn bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-4 rounded-lg">Selanjutnya <i class="fa-solid fa-chevron-right"></i></button></div></div>`;
    appContent.innerHTML = resultShellHTML;
    currentExplanationIndex = 0;
    renderSingleExplanation(currentExplanationIndex);
}

function renderSingleExplanation(index) {
    const container = document.getElementById('single-explanation-container');
    const title = document.getElementById('explanation-title');
    const quiz = currentQuizData;
    const q = quiz.questions[index];
    title.innerText = `⭐ Pembahasan Soal ${index + 1} / ${quiz.questions.length}`;
    const explanationHTML = `<div class="bg-gray-900/50 p-4 rounded-lg"><div class="mb-3 text-gray-300 text-lg">${q.questionText}</div><div class="space-y-2 text-sm"><p class="${userAnswers[index] === q.correctAnswer ? 'correct-answer' : 'wrong-answer'} p-2 rounded">Jawaban Anda: ${userAnswers[index] || 'Tidak dijawab'}</p><p class="correct-answer p-2 rounded">Jawaban Benar: ${q.correctAnswer}</p><div class="bg-gray-800 p-3 mt-3 rounded-md"><p class="font-bold text-cyan-300">Pembahasan:</p><p class="text-gray-400 mt-1">${q.explanation}</p></div></div></div>`;
    container.innerHTML = explanationHTML;
    document.getElementById('prev-explanation-btn').disabled = (index === 0);
    document.getElementById('next-explanation-btn').disabled = (index === quiz.questions.length - 1);
}

function nextExplanation() { if (currentExplanationIndex < currentQuizData.questions.length - 1) { currentExplanationIndex++; renderSingleExplanation(currentExplanationIndex); } }
function prevExplanation() { if (currentExplanationIndex > 0) { currentExplanationIndex--; renderSingleExplanation(currentExplanationIndex); } }

// =================================================================================
// BAGIAN 6: FUNGSI GLOBAL & INISIALISASI
// =================================================================================
function initializeApp() {
    const firstLink = document.querySelector('.sidebar-link');
    navigateTo('dashboard', firstLink);
}

function showToast(message, type = 'info') { const container = document.getElementById('toast-container'); const toast = document.createElement('div'); const icons = { info: 'fa-solid fa-circle-info', success: 'fa-solid fa-check-circle', error: 'fa-solid fa-triangle-exclamation' }; const colors = { info: 'text-cyan-400', success: 'text-green-400', error: 'text-red-400' }; const iconClass = icons[type] || icons['info']; const colorClass = colors[type] || colors['info']; toast.className = 'toast-in flex items-start p-4 rounded-lg shadow-lg text-sm'; toast.style.backgroundColor = 'var(--bg-panel)'; toast.style.border = '1px solid var(--border-color)'; toast.innerHTML = `<div class="flex-shrink-0"><i class="${iconClass} ${colorClass} text-xl"></i></div><div class="ml-3"><p class="font-bold capitalize ${colorClass}">${type}</p><p class="text-gray-300 mt-1">${message}</p></div>`; container.appendChild(toast); setTimeout(() => { toast.classList.remove('toast-in'); toast.classList.add('toast-out'); toast.addEventListener('animationend', () => { toast.remove(); }); }, 5000); }
</script>

</body>
</html>
